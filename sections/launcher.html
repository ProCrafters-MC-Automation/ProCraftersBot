<template class="section-template">
  <section id="launcher" class="wrapper style3">
    <h1 id="launcher-header">Bot Launcher</h1>
    <input type="text" name="address" id="address-field" class="launcher-form-field" placeholder="Server Address">
    <input type="text" name="port" id="port-field" class="launcher-form-field" placeholder="Server Port">
    <input type="text" name="password" id="password-field" class="launcher-form-field" placeholder="Bot Password">
    <input type="text" name="boss" id="boss-field" class="launcher-form-field" placeholder="Boss">
    <button name="bots" onclick="bots()">Start Bots</button>
    <button name="stop" onclick="stop()">Force Stop</button>
    <p id="botStarted"></p>
    <object data="src/debug.log" style="min-height:100vh;width:100%"></object>
    <script type="text/javascript">
      const { spawn } = require('child_process');
      const fs = require('fs');
      let botsProc;
      function bots() {
        document.getElementById("botStarted").innerHTML = "Bots have been started";
        console.log('Bot Log:')
        let address = document.getElementById('address-field').value
        let port = document.getElementById('port-field').value
        let password = document.getElementById('password-field').value
        let boss = document.getElementById('boss-field').value
        const out = fs.openSync('./out.log', 'a');
        const err = fs.openSync('./out.log', 'a');
        botsProc = spawn('cd src && node', ['index.js', address, port, password, boss], {
          detached: true,
          stdio: ['ignore', out, err],
          shell: true
        });
        botsProc.on('close', (code, signal) => {
          console.log('Bots were force stopped')
          console.log('In order to stop from within Minecraft: [BotName] leave')
        })
        botsProc.unref();
      }

      function stop() {
        botsProc.kill('SIGINT')
      }
    </script>
  </section>
</template>